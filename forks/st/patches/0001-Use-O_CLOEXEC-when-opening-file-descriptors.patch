From 171b94a605f3bf98078c24d12a7ec0c25537fa5b Mon Sep 17 00:00:00 2001
From: Arthur Williams <taaparthur@disroot.org>
Date: Sat, 15 Oct 2022 01:33:24 -0700
Subject: [PATCH] Use O_CLOEXEC when opening file descriptors

---
 st.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/st.c b/st.c
index 62def59..0ced7f1 100644
--- a/st.c
+++ b/st.c
@@ -760,7 +760,7 @@ ttynew(const char *line, char *cmd, const char *out, char **args)
 	if (out) {
 		term.mode |= MODE_PRINT;
 		iofd = (!strcmp(out, "-")) ?
-			  1 : open(out, O_WRONLY | O_CREAT, 0666);
+			  1 : open(out, O_WRONLY | O_CREAT | O_CLOEXEC, 0666);
 		if (iofd < 0) {
 			fprintf(stderr, "Error opening %s:%s\n",
 				out, strerror(errno));
@@ -768,7 +768,7 @@ ttynew(const char *line, char *cmd, const char *out, char **args)
 	}
 
 	if (line) {
-		if ((cmdfd = open(line, O_RDWR)) < 0)
+		if ((cmdfd = open(line, O_RDWR | O_CLOEXEC)) < 0)
 			die("open line '%s' failed: %s\n",
 			    line, strerror(errno));
 		dup2(cmdfd, 0);
-- 
2.37.1

